<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Chase</title>
	<link rel="stylesheet" href="css/gamestyles.css">
	<script src="js/vendor/jquery.js"> </script>
    <script src="js/client/clienthelpers.js"> </script>
	<script src="https://cdn.socket.io/socket.io-1.2.1.js"></script>
</head>


<body>
	<div class="game">
		<div class="target"> </div>
	</div>
</body>


<script>
	var socket = io();

	var score = 0;
	var mousemoves = 0;
	// Sending mouse position to others every 10th time
	$(document).on("mousemove", function(event){
		if (mousemoves % 10 == 0) {
			socket.emit('coordinates', {x: event.pageX, y: event.pageY} );
		}
	    mousemoves+=1;
	});

	//Click scoring logic
	//Target must be stationary
	//if not ==> lose a point
	$('.target').click(function(){
		if( !$(this).is(':animated') ) {
				console.log('Scored!');
				score++;
		}
		else if (score > 0){
				console.log('Lost point!');
				score--;
		}
	});


	socket.on('joined', function(data){
		addPlayer(data.id);
	});

	socket.on('otherPlayerMove', function(data){
		var id = data.id;
		var coordinates = data.coordinates;
		var $players = $('.player');
		var $otherPlayer = $("." + id);
		movePlayer(id, coordinates);
	});

	//Move the target 
	socket.on('movement', function(multipliers) {
		animateDiv(multipliers.hm, multipliers.wm);
	});

	//When game ends, hide game and players, display scores
	socket.on('gameover', function() {
		socket.emit('submit-score',  { score: score } );
		$('.game').hide();
		$('.player').hide();
	});

	socket.on('recieve-scores', function(data) {
		console.log('in recieve-scores');
		var scores = data.scores;
		$scores = $('<div class="score-container"><ul></ul></div>');
		for (var key in scores){
			var $score = $('<li>' + scores[key] + '</li>');
			console.log($score);
			$scores.append($score);
		}
		$('body').append($scores);
	});

	//Remove player from the screen when they disconnect
	socket.on('user disconnected', function(data){
		$('.'+ data.id).remove();
	});

</script>

</html>